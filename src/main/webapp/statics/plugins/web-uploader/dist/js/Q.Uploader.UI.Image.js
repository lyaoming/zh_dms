//devin87@qq.com
//build:2018/04/12 10:05:54
!function(e,t){"use strict";var i=Q.getFirst,a=Q.getNext,r=Q.createEle,o=Q.setOpacity,n=Q.ie,s=Q.Uploader;function l(e,t){e.className+=" "+t}function c(i,a,r){var o=a.input,s=a.file||(o.files?o.files[0]:t);if(s)!function(t,i){var a=e.URL||e.webkitURL;if(a)return i(a.createObjectURL(t));if(e.FileReader){var r=new FileReader;r.onload=function(e){i(e.target.result)},r.readAsDataURL(t)}else t.readAsDataURL&&i(t.readAsDataURL())}(s,function(e){e&&(i.innerHTML='<img src="'+e+'" />'),r&&r(e)});else if(o){var l=o.value;if(l&&!/^\w:\\fakepath/.test(l)||(o.select(),parent.document.body.focus(),document.selection&&(l=document.selection.createRange().text)),l){i.innerHTML='<img src="'+l+'" />';try{n>6&&(i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+l+"')")}catch(e){}}r&&r(l)}}var d=e.Blob||e.WebkitBlob||e.MozBlob,u=e.WebKitBlobBuilder||e.MozBlobBuilder,f=function(){if(!e.FileReader||!e.atob||!d&&!u)return!1;var t=document.createElement("canvas");return!!t.getContext&&!!t.getContext("2d")}();function v(e,t,i,a){var r=new Image;r.src=e,r.onload=function(){var e=r.width,o=r.height,n=i.maxWidth,s=i.maxHeight,l=n&&e>n,c=s&&o>s;if(!(l||c))return a&&a(!1);l&&(e=n,o=Math.floor(r.height*e/r.width)),c&&(o=s,e=Math.floor(r.width*o/r.height));var d=document.createElement("canvas"),u=d.getContext("2d");d.width=e,d.height=o,u.drawImage(r,0,0,e,o),a&&a(d.toDataURL(t),t)}}var g=".jpg,.png,.gif,.bmp,.webp,.tif,.tiff";s.support.imageScale=f,s.previewImage=c,s.scaleImage=v,s.UI.Image={init:function(){var e=this.ops,t=e.view;e.allows||(e.allows=g),t&&l(t,"ui-image "+(this.html5?"html5":"html4"))},supportScale:function(e){if(!f)return!1;".jpeg"==e&&(e=".jpg");var t=(this.ops.scale||{}).types||".jpg";return!(-1==g.indexOf(e))&&("*"==t||-1!=t.indexOf(e))},previewImage:function(e,t,i){var a=this,r=t.scale||i.scale,o=r&&a.supportScale(t.ext);return o&&(t.skip=!0),c(e,t,function(e){var i,n;(a.fire("preview",{task:t,src:e}),e&&o)&&v(e,(i=t.ext,"image/"+("jpg"==(n=i.slice(1))?"jpeg":n)),r,function(e,i){if(e){var r=function(e,t){for(var i=e.split(","),a=atob(i[1]),r=[],o=0,n=a.length;o<n;o++)r[o]=a.charCodeAt(o);if(d)return new d([new Uint8Array(r)],{type:t});var s=new u;return s.append(r),s.getBlob(t)}(e,i);t.blob=r,a.fire("scale",{task:t,base64:e,type:i,blob:r})}t.skip=!1,a.list.push(t),a.auto&&a.start()})}),a},draw:function(e){var t=this,n=t.ops,s=n.view;if(s){var l=e.name,c='<div class="u-img"></div><div class="u-progress-bar"><div class="u-progress"></div></div><div class="u-detail"></div><div class="u-name" title="'+l+'">'+l+'</div><div class="u-close-bg"></div><div class="u-close-text">X</div>',d=e.id,u=r("div","u-item",c);u.taskId=d;var f=i(u),v=a(f),g=i(v),p=a(v),m=a(p),h=a(m),b=a(h);o(v,.3),o(g,.5),o(h,.3),b.onclick=function(){s.removeChild(u),t.remove(d)},e.box=u,e.boxProgress=g,e.boxDetail=p,e.boxName=m,s.appendChild(u),t.previewImage(f,e,n).update(e)}},update:function(e){if(e&&e.box){var i,a,r=e.total||e.size,o=e.loaded,n=e.state,l=e.boxProgress,c=e.boxDetail,d=s.getStatusText(n);if(this.html5&&o!=t&&o>=0){var u;if(n==s.PROCESSING)"100.0"==(u=Math.min(100*o/r,100).toFixed(1))&&(u="99.9");else n==s.COMPLETE&&(u="100");u&&(d+=" "+(u+="%"),l.style.width=u)}a=d,(i=c)&&(i.innerHTML=a||"")}},over:function(e){e&&e.box&&l(e.box,"u-over")}},s.extend(s.UI.Image)}(window);