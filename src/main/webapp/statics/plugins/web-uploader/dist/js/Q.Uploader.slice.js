//devin87@qq.com
//build:2018/11/07 12:12:53
!function(e,n){"use strict";var o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,m=Q.Uploader;m.extend({_upload_slice:function(l){var c,p=this,e=l.blob||l.file,d=e.size,n=p.chunkSize,u=l.sliceStart||0,f=p.sliceRetryCount,h=function(e,i,n){var t=new XMLHttpRequest,o=l.url,r=c==d;l.xhr=t,o+=(-1==o.indexOf("?")?"?":"&")+"action=upload&hash="+(l.hash||l.name)+"&ok="+(r?"1":"0"),t.upload.addEventListener("progress",function(e){p.progress(l,d,u+e.loaded)},!1);var a=function(){if(n=+n||0,f<++n)return p.complete(l,m.ERROR);h(e,i,n)};t.addEventListener("load",function(e){var n=e.target.responseText;return r?p.complete(l,m.COMPLETE,n):1==n||'"1"'==n?i():void a()},!1),t.addEventListener("error",a,!1);var s=new FormData;p._process_params(l,function(e,n){s.append(e,n)}),s.append("fileName",l.name),-1!=l.size&&s.append("fileSize",l.size),s.append(p.upName,e,l.name),s.append("sliceCount",l.sliceCount),s.append("sliceIndex",l.sliceIndex),t.open("POST",o),p._process_xhr_headers(t),r?p.fire("send",l,function(e){if(!1===e)return p.complete(l,m.SKIP);t.send(s)}):t.send(s)};l.sliceCount=Math.ceil(d/n);var i=function(){d<=u||(d<(c=u+n)&&(c=d),l.sliceStart=u,l.sliceEnd=c,l.sliceIndex=Math.ceil(c/n),l.sliceBlob=o.call(e,u,c),p.fire("sliceUpload",l,function(e){if(!1===e)return t();h(l.sliceBlob,t)}))},t=function(){u=c,i()};i(),p._afterSend(l)}})}(window);